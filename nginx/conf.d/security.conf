# =============================================
# SECURITY CONFIGURATION - CMM AUTOMACAO
# Additional security headers and configurations
# =============================================

# Hide nginx version
more_clear_headers Server;
more_set_headers "Server: CMM-Nginx/2.2";

# Additional security headers for all locations
more_set_headers "X-Robots-Tag: noindex, nofollow";
more_set_headers "X-Download-Options: noopen";
more_set_headers "X-Permitted-Cross-Domain-Policies: none";

# Prevent clickjacking
more_set_headers "X-Frame-Options: SAMEORIGIN";

# Prevent MIME sniffing
more_set_headers "X-Content-Type-Options: nosniff";

# Enable XSS protection
more_set_headers "X-XSS-Protection: 1; mode=block";

# Referrer policy
more_set_headers "Referrer-Policy: strict-origin-when-cross-origin";

# Feature policy / Permissions policy
more_set_headers "Permissions-Policy: camera=(), microphone=(), geolocation=(), payment=(), usb=()";

# Block access to sensitive files
location ~ /\.(git|svn|hg|bzr) {
    deny all;
    access_log off;
    log_not_found off;
}

# Block access to backup and temporary files
location ~ \.(bak|backup|swp|tmp|temp)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# Block access to configuration files
location ~ \.(conf|config|ini|yml|yaml|json)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# Block access to log files
location ~ \.log$ {
    deny all;
    access_log off;
    log_not_found off;
}